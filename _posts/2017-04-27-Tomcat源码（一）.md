---
layout: post 
title: "Tomcat源码解析（一）" 
date: 2017-04-27 
description: "Tomcat源码解析（一）" 
tag: tomcat
---

  笔者在工作过程中遇到的Web容器主要是Tomcat以及Weblogic，一直以来对tomcat是如何加载web项目，如何接收浏览器的请求等问题存在疑问。希望通过阅读tomcat源码来解答自己的这些问题。这篇文章主要介绍如何用Eclipse阅读Tomcat源码。

  笔者是从[github](https://github.com/apache/tomcat)上下载的源码，从github上下载源码有两种方式（本篇文章以第二种方式为例子）

- 将项目fork到自己的github，然后clone到本地()
- 直接下载zip包，解压之后导入到Eclipse

#### <span style="color:red">从github上下载源码</span>

<img src="/images/posts/tomcat-01/tomcat-01-1.png" height="489" width="1006">

#### <span style="color:red">将下载的zip包解压缩，将工程导入Eclipse</span>

因为下载的源码不是一个java工程，因此在导入之前需要先在Eclipse中创建一个tomcat的java工程。

- 右键工程->import->General->File System->Next
- 选择解压缩后的文件夹，勾选tomcat-trunk后点击Finish，完成导入

导入之后，工程目录结构如下

<img src="/images/posts/tomcat-01/tomcat-01-2.png" height="438" width="344">

#### <span style="color:red">源码编译</span>

目前的代码结构是没有办法运行的，需要在Build Path上加入源码。右键tomcat->Build Path->Configure Build Path ->Source->Add Folder，将java跟test（test不影响运行，可以不加入）目录加入Source，如下图：
<img src="/images/posts/tomcat-01/tomcat-01-3.png" height="560" width="735">

点击OK之后，Eclipse开始编译工程，编译之后发现工程报错了，需要加入下面的jar。这些jar可以从我的[git](https://github.com/Arron-David/tomcat-jar)中下载。

- ant.jar
- easymock-3.4.jar
- ecj-4.6.1.jar
- jaxrpc-api-1.1.jar
- wsdl4j-1.6.2.jar
- junit(直接用junit4)

#### <span style="color:red">Ant编译</span>

- 将工程目录中的build.properties.default修改为build.properties。
- 右键build.xml，选择Run As-> Ant Build

在执行完成之后，工程目录下出现output目录，这是编译之后生成的。其实我们会发现这个结构和从安装包里解压出来的tomcat结构一致的。
<img src="/images/posts/tomcat-01/tomcat-01-4.png" height="265" width="316">

#### <span style="color:red">运行tomcat</span>

tomcat的运行入口类为`org.apache.catalina.startup.Bootstrap`，右键->Run As->Run Configurations,在Arguments中的VM arguments中加入`-Dcatalina.home="上面提及的output中的build目录的路径"`，点击Run

<img src="/images/posts/tomcat-01/tomcat-01-5.png" height="632" width="786">

#### <span style="color:red">访问tomcat首页</span>

在启动完成之后，访问[首页](http://localhost:8080/),看到如下画面：
<img src="/images/posts/tomcat-01/tomcat-01-6.png" height="634" width="1029">
点击`Examples`等都可以查看到相应界面。

至此，tomcat源码启动已经完成。
